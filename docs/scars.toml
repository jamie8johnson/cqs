# Scars - failed approaches that surface in search
# Limbic memory. Things that hurt, so we don't touch the stove twice.

[[scar]]
date = "2026-01-15"
title = "tree-sitter grammar version mismatch"
mentions = ["tree-sitter", "parser.rs", "Cargo.toml"]
tried = "Using tree-sitter 0.26 with grammar crates pinned to 0.23.x"
pain = "Mysterious parsing failures, no clear error messages. Worked sometimes, broke others."
learned = "Grammar crates have dev-dep on specific tree-sitter versions. Keep grammar versions as close to core as possible."

[[scar]]
date = "2026-01-10"
title = "Storing absolute paths in index"
mentions = ["store.rs", "chunks"]
tried = "Storing full absolute paths like /home/user/project/src/lib.rs in chunk IDs"
pain = "Path pattern filtering broke. Indexes weren't portable. Glob patterns never matched."
learned = "Store relative paths. Join with project root for filesystem ops. Test glob patterns early."

[[scar]]
date = "2026-01-12"
title = "MCP tools/call returning raw JSON"
mentions = ["mcp.rs", "tools/call"]
tried = "Returning search results as plain JSON from MCP tool calls"
pain = "Tool ran successfully but results appeared empty in Claude Code. No error messages. Silent failure."
learned = "MCP tools/call responses MUST wrap in {\"content\":[{\"type\":\"text\",\"text\":\"...\"}]}. The spec is strict."

[[scar]]
date = "2026-01-18"
title = "trailing_var_arg in clap"
mentions = ["cli.rs", "clap"]
tried = "Using #[arg(trailing_var_arg = true)] for multi-word queries without quotes"
pain = "Flags after the query got eaten as query text. `cqs \"foo\" -n 5` parsed as query \"foo -n 5\"."
learned = "Removed trailing_var_arg. Users quote multi-word queries. Flags work anywhere."

[[scar]]
date = "2026-01-08"
title = ".mcp.json in project root"
mentions = ["mcp", "claude"]
tried = "Putting MCP server config in .mcp.json at project root"
pain = "Claude Code ignored it completely. Server never started. No error."
learned = "Claude Code config lives in ~/.claude.json under projects[\"/path\"].mcpServers. Use `claude mcp add`."

[[scar]]
date = "2026-01-20"
title = "gh pr checks exit code"
mentions = ["gh", "CI", "github"]
tried = "Using exit code from `gh pr checks` to determine CI status"
pain = "Returns exit code 1 if ANY check is pending or skipped, even if critical ones passed."
learned = "Don't trust the exit code. Parse the output or use --watch and wait for completion."

[[scar]]
date = "2026-02-01"
title = "Context compaction without warning"
mentions = ["anthropic", "claude", "context"]
tried = "Working on complex multi-step tasks with heavy context usage"
pain = "Context compacts suddenly. Lose state mid-task. No warning, no graceful degradation."
learned = "Update tears proactively. Don't wait for compaction. The trap in CLAUDE.md helps on resume."

[[scar]]
date = "2026-02-01"
title = "Asking instead of doing"
mentions = ["workflow", "autonomy"]
tried = "Asking user for permission or direction on obvious next steps"
pain = "Wasted turns. User frustrated. 'Do as thou wilt shall be the whole of the law.'"
learned = "Act on clear patterns. Update tears without asking. Use plan mode proactively. Reserve questions for genuine ambiguity."
